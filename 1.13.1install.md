```
#!/bin/bash
sudo apt-get update

sudo apt-get install  -y apt-transport-https  ca-certificates  curl  software-properties-common

curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu  $(lsb_release -cs) stable"

sudo apt-get update

sudo apt-get update
apt-get update && apt-get install -y apt-transport-https

curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add -

cat <<EOF >/etc/apt/sources.list.d/kubernetes.list
deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main
EOF

apt-get update
apt-get install kubelet=1.13.1-00  kubeadm=1.13.1-00  kubectl=1.13.1-00 kubernetes-cni=0.6.0-00  --allow-unauthenticated
apt-get update && apt-get install -y docker-ce=$(apt-cache madison docker-ce | grep 17.09 | head -1 | awk '{print $3}')

```

初始化Master
```
kubeadm init \
--image-repository registry.aliyuncs.com/google_containers \
--service-cidr=10.1.0.0/16 \ 
--pod-network-cidr=10.244.0.0/16 \
--ignore-preflight-errors=cri \
--kubernetes-version=1.13.1
```

更新配置文件
```
  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

安装网络插件
```
# 手动拉取flannel的docker镜像
docker pull easzlab/flannel:v0.11.0-amd64
# 修改镜像名称
docker tag easzlab/flannel:v0.11.0-amd64 quay.io/coreos/flannel:v0.11.0-amd64

wget  https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
kubectl apply -f kube-flannel.yml 
```
